# Lab 5-1
The address of DllMain is 0x1000D02E in the .text section.

the address for gethostbyname is 0x100163CC in the .idata section and is called by 5 different functions.

A DNS request for pics.practicalmalwareanalysis.com will be made if the call to gethostbyname in 0x1000174E.

IDA has recognized 23 local variables and 1 parameter at subroutine 0x010001656.

the string \cmd.exe /c is located at 0x10095B34 in the xdoors_d section.
This section appears to create a remote shell session for the attacker.

Cross-referencing dword_1008E5C4 shows us that the subroutine 0x01000656 sets dword_1008E5C4.

If the string comparison to robotwork succeeds, the values of registry keys HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion WorkTime & WorkTimes are queried and sent to the attacker over the shell.

PSLIST sends a process listing over the network or a particular process in the listing and gets information about it.

The important API calls made from sub_10004E79 GetSystemDefaultLangID, sprintf and send. Based on these API calls a fitting rename is GetSystemLanguage.

DllMain directly calls 4 Windows API functions. At depth of 2, it calls 31 API functions.

Looking back through the code, we can see the string "[This is CTI]30" moved into eax. eax is then moved to the position of the letter '3'. It is then cast into a number and multiplied by 1000. As such, the program will sleep for 30 seconds.

The arguments for the call to socket at 0x10001701 are 2, 1 & 6, for af, type & protocol, respectively. Fitting symbolic constants are AF_INET, SOCK_STREAM & IPPROTO_TCP.

We can find the IN instruction by searching for its opcode. The instruction is used in 0x100061DB, where 564D5868h corresponds to VMXh. Using the cross-reference, we can see a string: "Found Virtual Machine, Install cancel."

There seems to be random data at 0x1001D988, which might be an obfuscated string.
After running the Lab05-01.py script the random data got deobfuscated, which can be converted into a string by pressing the A key:"xdoor is this backdoor, string decoded for Practical Malware Analysis Lab :)1234". The decoding works by performing a XOR operation on 0x50 bytes of data with the numbers 0x55 and modifying the values in IDA with PatchByte.
