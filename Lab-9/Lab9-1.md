# Lab 9-1
When running the program without any arguments, it will delete itself. We will try to pass any of the strings in the .exe as arguments. If we pass just '-in', it will go into a new subroutine at 0x402510, but will return and delete itself yet again. Looking at the function tells us it is checking for another argument as sort of a password. If the password is correct then EAX will be 1, else it will be 0. From here there 2 paths from here: The 1st is to patch the function to always return 1 and thus skip the entire check.
To patch the binary we simply need to make sure EAX will be 1 on return. To do that we can insert the following instructions at the beginning of the function: MOV EAX, 0x1 & RET. (To insert the instructions we can select the start address and choose Assemble and enter the instructions separately and then copy to executable to save the changes). The 2nd way is to simply reverse engineer the password. First, the function checks if the argument passed to it is of length 4. The first character then needs to be 'a'. The 2nd check the function makes is if the 2nd character is 'a'+1, which means it has to be 'b'. The next check is if the 3rd character is 'c', and finally, it checks if the last character is 'd'. As such, the 2nd argument to the program needs to be abcd.

The password is required for all commandline actions to work. The -in option makes the malware install itself, the -re option makes the malware remove itself, the -c option makes the malware update its configuration and the -cc option makes the malware print its configuration. By default the malware acts as a backdoor.

The host-based indicators for this malware are the registry key SOFTWARE\Microsoft \XPS\Configuration that the malware creates, the service X Manager Service, where X is either an argument passed to the program or the name of the executable, and finally the file %SYSTEMROOT%\system32\X.exe.

The backdoor can take one of 5 commands: SLEEP, which will instruct the malware to sleep for a certain amount of time, UPLOAD will read a file from the network and write it into a local file, DOWNLOAD will instruct the malware to send contents of a local file over the network and NOTHING which is a no-op command.

A useful network-based indicator is the default address which the malware beacons: http://www.practicalmalwareanalysis.com. However this is configurable.