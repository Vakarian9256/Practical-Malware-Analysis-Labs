# Lab 1-3
 The software has been detected by 47 security vendors.

 At first glance we can see that the sections' names are the same, which hints at the file being packed. We can also see that for one section, the space allocated for it is 300, while the size on disk is 0 and that the only imported functions are LoadLibrary and GetProcAddress. As such the file is most likely packed. We'll check what packer was used with PEiD. PEiD tells us the file has been packed with FSG.
To unpack it We'll open it in OllyDBG. Lets set a breakpoint at the address 0x004050E9 - the point right before GetProcAddress is called. By stepping through the instructions we can see the program is trying to rebuild the address for CoCreateInstance. After several iterations of stepping we can see a jump to an address not seen in the previous assembly code, 0x401090. The address might be the OEP, as such we'll set a hardware breakpoint on write on it. We run the program again and by stepping through we can see that the program is writing, starting at the above-mentioned address. If we'll step more we could see the entire code getting unpacked. We'll set a software breakpoint at the same address and restart the program. Now we open PEiD and unpack the file with the PEO we just got and repair the imports with imp REC. Now we can see all the imported functions.
   
Another option for unpacking is by using the plugin Ollydump. The plugin can find the OEP by choosing the "Find OEP by section hop (trace over)" and then dumping the debugged process.

 The only interesting import is CoCreateInstance. The syntax for the function is: 
```C++
HRESULT CoCreateInstance(
  [in]  REFCLSID  rclsid,
  [in]  LPUNKNOWN pUnkOuter,
  [in]  DWORD     dwClsContext,
  [in]  REFIID    riid,
  [out] LPVOID    *ppv
);
```

The function creates an object of the class associated with the specified  clsid.
Lets find the clsid by debugging the unpacked program. Above the call to the function, are the PUSH instructions for the arguments for the function. the clsid is located at 0x402058, and it is 002DF01- 0000-0000-C000-0000-00000046.
In the registry this ID refers to Internet Explorer.
Further down the assembly code, we can see a function being called with an offset of 2C. Note that EDX points to the ppv argument of CoCreateInstance. After stepping over the instruction, Internet Explorer opens at the URL www.malwareanalysisbook.com/ad.html

A network-based indicator on infected systems is network traffic to the URL mentioned above.
